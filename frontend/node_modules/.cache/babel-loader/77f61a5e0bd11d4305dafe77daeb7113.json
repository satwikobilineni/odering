{"ast":null,"code":"import axios from \"axios\";\nimport { mapState } from \"vuex\";\nconst __default__ = {\n  name: \"Checkout\",\n  data() {\n    return {\n      checkoutObj: {\n        phone: \"\",\n        address: \"\",\n        paymentMethod: \"\"\n      },\n      cardObj: {\n        number: \"\",\n        name: \"\",\n        expiryDate: \"\",\n        cvv: \"\"\n      },\n      errorObj: {\n        phoneErr: [],\n        addressErr: [],\n        payErr: [],\n        numErr: [],\n        nameErr: [],\n        exDateErr: [],\n        cvvErr: []\n      },\n      cartItem: [],\n      itemQuantity: []\n    };\n  },\n  created() {\n    this.getAllCartItem();\n  },\n  computed: {\n    ...mapState([\"allFoods\", \"user\"]),\n    filterFoods: function () {\n      return this.allFoods.filter(f => this.matchID(f, this.cartItem));\n    }\n  },\n  methods: {\n    availableTime: function () {\n      var now = new Date();\n      var currentMonth = (\"0\" + (now.getMonth() + 1)).slice(-2);\n      var minRange = now.getFullYear() + \"-\" + currentMonth;\n      var maxRange = now.getFullYear() + 10 + \"-\" + currentMonth;\n      document.getElementById(\"coCardEx\").setAttribute(\"min\", minRange);\n      document.getElementById(\"coCardEx\").setAttribute(\"max\", maxRange);\n    },\n    matchID: function (food, cartArray) {\n      let temp = \"\";\n      cartArray.forEach(element => {\n        if (parseInt(food.food_id) == element) {\n          temp = food;\n        }\n      });\n      return temp;\n    },\n    calculateSummaryPrice: function () {\n      let subtotal = 0;\n      let discount = 0;\n      let delivery = 15;\n      let i = 0;\n      while (i < this.itemQuantity.length) {\n        subtotal = subtotal + parseInt(this.filterFoods[i].food_price) * this.itemQuantity[i];\n        discount = discount + parseInt(this.filterFoods[i].food_discount) * this.itemQuantity[i];\n        i = i + 1;\n      }\n      if (!this.filterFoods.length) {\n        delivery = 0;\n      }\n      let total = subtotal - discount + delivery;\n      return [subtotal, discount, delivery, total];\n    },\n    async getAllCartItem() {\n      if (this.user) {\n        let existItem = await axios.get('/cartItem/' + this.user.user_id);\n        existItem.data.forEach(element => {\n          this.cartItem.push(element.food_id);\n          this.itemQuantity.push(element.item_qty);\n        });\n      }\n    },\n    resetCheckErr: function () {\n      this.errorObj.phoneErr = [];\n      this.errorObj.addressErr = [];\n      this.errorObj.payErr = [];\n      this.errorObj.numErr = [];\n      this.errorObj.nameErr = [];\n      this.errorObj.exDateErr = [];\n      this.errorObj.cvvErr = [];\n    },\n    checkEmptyErr: function () {\n      for (var typeErr in this.errorObj) {\n        if (this.errorObj[typeErr].length != 0) {\n          return false;\n        }\n      }\n      return true;\n    },\n    inputUpcase: function (e) {\n      e.target.value = e.target.value.toUpperCase();\n    },\n    checkForm: function () {\n      this.resetCheckErr();\n\n      // Phone validate\n      if (!this.checkoutObj.phone) {\n        this.errorObj.phoneErr.push('Entering phone number is required');\n      } else {\n        if (!this.checkoutObj.phone.startsWith('84')) {\n          this.errorObj.phoneErr.push('Phone numbers must start with 84');\n        }\n        if (this.checkoutObj.phone.length != 11) {\n          this.errorObj.phoneErr.push('Phone numbers must have exactly 11 digits');\n        }\n        if (!/[0-9]{11}/.test(this.checkoutObj.phone)) {\n          this.errorObj.phoneErr.push('Phone numbers can only contain numbers');\n        }\n      }\n\n      // Address validate\n      if (!this.checkoutObj.address) {\n        this.errorObj.addressErr.push('Entering address is required');\n      }\n\n      // Card validate\n      if (!this.checkoutObj.paymentMethod) {\n        this.errorObj.payErr.push('Selecting payment method is required');\n      } else if (this.checkoutObj.paymentMethod == \"card\") {\n        if (!this.cardObj.number) {\n          this.errorObj.numErr.push('Entering card number is required');\n        } else {\n          if (!this.cardObj.number.startsWith('4')) {\n            this.errorObj.numErr.push('Visa card numbers must start with 4');\n          }\n          if (this.cardObj.number.length != 16) {\n            this.errorObj.numErr.push('Visa card numbers must have exactly 16 digits');\n          }\n          if (!/[0-9]{16}/.test(this.cardObj.number)) {\n            this.errorObj.numErr.push('Visa card numbers can only contain numbers');\n          }\n        }\n        if (!this.cardObj.name) {\n          this.errorObj.nameErr.push('Entering name is required');\n        } else {\n          if (!/^[A-Za-z]+$/.test(this.cardObj.name.replace(/\\s/g, \"\"))) {\n            this.errorObj.nameErr.push('A name can only contain letters');\n          }\n        }\n        if (!this.cardObj.expiryDate) {\n          this.errorObj.exDateErr.push('Entering expiry date is required');\n        }\n        if (!this.cardObj.cvv) {\n          this.errorObj.cvvErr.push('Entering cvv code is required');\n        } else {\n          if (this.cardObj.cvv.length != 3) {\n            this.errorObj.cvvErr.push('Cvv code must have exactly 3 digits');\n          }\n          if (!/[0-9]{3}/.test(this.cardObj.cvv)) {\n            this.errorObj.cvvErr.push('Cvv code can only contain numbers');\n          }\n        }\n      } else if (this.checkoutObj.paymentMethod == \"cash\") {\n        this.cardObj.number = \"\";\n        this.cardObj.name = \"\";\n        this.cardObj.expiryDate = \"\";\n        this.cardObj.cvv = \"\";\n        this.errorObj.numErr = [];\n        this.errorObj.nameErr = [];\n        this.errorObj.exDateErr = [];\n        this.errorObj.cvvErr = [];\n      }\n    },\n    isPaid: function () {\n      if (this.checkoutObj.paymentMethod == \"cash\") {\n        return \"false\";\n      } else if (this.checkoutObj.paymentMethod == \"card\") {\n        return \"true\";\n      }\n    },\n    async sendBillDetails(billId, foodId, qty) {\n      let billDetails = {\n        bill_id: parseInt(billId),\n        food_id: parseInt(foodId),\n        item_qty: parseInt(qty)\n      };\n      await axios.post(\"/billdetails\", billDetails);\n    },\n    async handleSubmit(e) {\n      this.checkForm();\n      if (!this.checkEmptyErr()) {\n        e.preventDefault();\n      } else {\n        e.preventDefault();\n        let billId = (await axios.get(\"/billstatus/new\")).data;\n        if (billId == \"\") {\n          billId = 1;\n        } else {\n          billId = parseInt(billId.bill_id) + 1;\n        }\n        this.cartItem.forEach((foodId, index) => {\n          this.sendBillDetails(billId, foodId, this.itemQuantity[index]);\n        });\n        var now = new Date();\n        var day = (\"0\" + now.getDate()).slice(-2);\n        var month = (\"0\" + (now.getMonth() + 1)).slice(-2);\n        var hour = (\"0\" + now.getHours()).slice(-2);\n        var min = (\"0\" + now.getMinutes()).slice(-2);\n        var currentTime = now.getFullYear() + \"-\" + month + \"-\" + day + \"T\" + hour + \":\" + min;\n        let billStatus = {\n          bill_id: parseInt(billId),\n          user_id: parseInt(this.user.user_id),\n          bill_phone: this.checkoutObj.phone,\n          bill_address: this.checkoutObj.address,\n          bill_when: currentTime,\n          bill_method: this.checkoutObj.paymentMethod,\n          bill_discount: parseInt(this.calculateSummaryPrice()[1]),\n          bill_delivery: parseInt(this.calculateSummaryPrice()[2]),\n          bill_total: parseInt(this.calculateSummaryPrice()[3]),\n          bill_paid: this.isPaid(),\n          bill_status: 1\n        };\n        axios.post(\"/billstatus\", billStatus);\n        axios.delete(\"/cartItem/\" + this.user.user_id);\n        this.cartItem = [];\n        this.itemQuantity = [];\n        this.$router.push(\"/thank\");\n      }\n    }\n  }\n};\nexport default /*#__PURE__*/Object.assign(__default__, {\n  setup(__props, {\n    expose\n  }) {\n    expose();\n\n    // enables v-focus in templates\n    const vUpcase = {\n      mounted(el) {\n        el.style.textTransform = \"uppercase\";\n      }\n    };\n    const __returned__ = {\n      vUpcase,\n      axios,\n      mapState\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n});","map":{"version":3,"mappings":"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","names":["axios","mapState","name","data","checkoutObj","phone","address","paymentMethod","cardObj","number","expiryDate","cvv","errorObj","phoneErr","addressErr","payErr","numErr","nameErr","exDateErr","cvvErr","cartItem","itemQuantity","created","getAllCartItem","computed","filterFoods","allFoods","filter","f","matchID","methods","availableTime","now","Date","currentMonth","getMonth","slice","minRange","getFullYear","maxRange","document","getElementById","setAttribute","food","cartArray","temp","forEach","element","parseInt","food_id","calculateSummaryPrice","subtotal","discount","delivery","i","length","food_price","food_discount","total","user","existItem","get","user_id","push","item_qty","resetCheckErr","checkEmptyErr","typeErr","inputUpcase","e","target","value","toUpperCase","checkForm","startsWith","test","replace","isPaid","sendBillDetails","billId","foodId","qty","billDetails","bill_id","post","handleSubmit","preventDefault","index","day","getDate","month","hour","getHours","min","getMinutes","currentTime","billStatus","bill_phone","bill_address","bill_when","bill_method","bill_discount","bill_delivery","bill_total","bill_paid","bill_status","delete","$router","vUpcase","mounted","el","style","textTransform"],"sources":["C:/Users/satwi/Downloads/temp/restaurant-ordering-system/frontend/src/pages/Checkout.vue"],"sourcesContent":["<template>\r\n    <div class=\"checkout-container\">\r\n        <div class=\"checkout-form-container\">\r\n            <form id=\"checkoutForm\" @submit=\"handleSubmit\" novalidate autocomplete=\"off\">\r\n                <div class=\"checkout-heading\">\r\n                    <h3>Few more step to place your order<span>Total</span></h3>\r\n                    <h3 v-if=\"user\">{{ user.user_name }}'s Order<span>${{ calculateSummaryPrice()[3] }}</span></h3>\r\n                </div>\r\n\r\n                <div class=\"form-group details-group\">\r\n                    <h4>Shipping Details</h4>\r\n                    <div class=\"form-group\">\r\n                        <input type=\"text\" name=\"coPhone\" id=\"coPhone\" placeholder=\"Phone number\" class=\"form-control\"\r\n                            v-model=\"checkoutObj.phone\" />\r\n                        <p class=\"error-mess\" v-if=\"errorObj.phoneErr.length > 0\">{{ errorObj.phoneErr[0] }}</p>\r\n                    </div>\r\n\r\n                    <div class=\"form-group\">\r\n                        <input type=\"text\" name=\"coAddress\" id=\"coAddress\" placeholder=\"Address in Hanoi, Vietnam\"\r\n                            class=\"form-control\" v-model=\"checkoutObj.address\" />\r\n                        <p class=\"error-mess\" v-if=\"errorObj.addressErr.length > 0\">{{ errorObj.addressErr[0] }}</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div class=\"form-group details-group\">\r\n                    <h4>Payment Method</h4>\r\n                    <div class=\"form-group\">\r\n                        <div class=\"form-group\">\r\n                            <input type=\"radio\" name=\"payment\" value=\"cash\" id=\"paymentCash\"\r\n                                v-model=\"checkoutObj.paymentMethod\" /><span>Cash</span>\r\n                            <input type=\"radio\" name=\"payment\" value=\"card\" id=\"paymentCard\"\r\n                                v-model=\"checkoutObj.paymentMethod\" /><span>Card (Visa)</span>\r\n                        </div>\r\n                        <p class=\"error-mess\" v-if=\"errorObj.payErr.length > 0\">{{ errorObj.payErr[0] }}</p>\r\n                    </div>\r\n\r\n\r\n                    <div v-if=\"checkoutObj.paymentMethod == 'card'\">\r\n                        <div class=\"form-group\">\r\n                            <input type=\"text\" name=\"coCardNum\" placeholder=\"Enter your card number\" id=\"coCardNum\"\r\n                                class=\"form-control\" v-model=\"cardObj.number\" size=\"16\" maxlength=\"16\" />\r\n                            <p class=\"error-mess\" v-if=\"errorObj.numErr.length > 0\">{{ errorObj.numErr[0] }}</p>\r\n                        </div>\r\n\r\n                        <div class=\"form-group\">\r\n                            <input v-upcase type=\"text\" name=\"coCardName\" placeholder=\"Enter the name in your card \"\r\n                                id=\"coCardName\" class=\"form-control\" v-model=\"cardObj.name\" />\r\n                            <p class=\"error-mess\" v-if=\"errorObj.nameErr.length > 0\">{{ errorObj.nameErr[0] }}</p>\r\n                        </div>\r\n\r\n                        <div class=\"form-group\">\r\n                            <div class=\"form-control\">\r\n                                <span\r\n                                    style=\"font-size: 1.6rem; position: absolute; margin-left: -5px; margin-top: -11px;\">Expiry\r\n                                    Date:\r\n                                </span>\r\n                                <input\r\n                                    style=\"position: absolute; margin-left: 100px; margin-top: -12px; background: inherit;\"\r\n                                    type=\"month\" name=\"coCardEx\" id=\"coCardEx\" v-model=\"cardObj.expiryDate\"\r\n                                    @click=\"availableTime()\" />\r\n                            </div>\r\n                            <p class=\"error-mess\" v-if=\"errorObj.exDateErr.length > 0\">{{ errorObj.exDateErr[0] }}</p>\r\n                        </div>\r\n\r\n                        <div class=\"form-group\">\r\n                            <input type=\"text\" name=\"coCardCvv\" placeholder=\"CVV\" id=\"coCardCvv\" class=\"form-control\"\r\n                                v-model=\"cardObj.cvv\" />\r\n                            <p class=\"error-mess\" v-if=\"errorObj.cvvErr.length > 0\">{{ errorObj.cvvErr[0] }}</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div v-if=\"user\" class=\"form-group\">\r\n                    <input type=\"submit\" value=\"CONFIRM & PAY\" class=\"btn\"\r\n                        :disabled=\"filterFoods.length ? false : true\" />\r\n                </div>\r\n            </form>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\";\r\nimport { mapState } from \"vuex\";\r\nexport default {\r\n    name: \"Checkout\",\r\n\r\n    data() {\r\n        return {\r\n            checkoutObj: { phone: \"\", address: \"\", paymentMethod: \"\" },\r\n            cardObj: { number: \"\", name: \"\", expiryDate: \"\", cvv: \"\" },\r\n            errorObj: { phoneErr: [], addressErr: [], payErr: [], numErr: [], nameErr: [], exDateErr: [], cvvErr: [] },\r\n            cartItem: [],\r\n            itemQuantity: [],\r\n        }\r\n    },\r\n\r\n    created() {\r\n        this.getAllCartItem();\r\n    },\r\n\r\n    computed: {\r\n        ...mapState([\"allFoods\", \"user\"]),\r\n\r\n        filterFoods: function () {\r\n            return this.allFoods.filter(\r\n                (f) => this.matchID(f, this.cartItem)\r\n            );\r\n        },\r\n    },\r\n\r\n    methods: {\r\n        availableTime: function () {\r\n            var now = new Date();\r\n            var currentMonth = (\"0\" + (now.getMonth() + 1)).slice(-2);\r\n\r\n            var minRange = now.getFullYear() + \"-\" + currentMonth;\r\n            var maxRange = (now.getFullYear() + 10) + \"-\" + currentMonth;\r\n\r\n            document.getElementById(\"coCardEx\").setAttribute(\"min\", minRange);\r\n            document.getElementById(\"coCardEx\").setAttribute(\"max\", maxRange);\r\n        },\r\n\r\n        matchID: function (food, cartArray) {\r\n            let temp = \"\";\r\n            cartArray.forEach(element => {\r\n                if (parseInt(food.food_id) == element) {\r\n                    temp = food\r\n                }\r\n            });\r\n            return temp\r\n        },\r\n\r\n        calculateSummaryPrice: function () {\r\n            let subtotal = 0;\r\n            let discount = 0;\r\n            let delivery = 15;\r\n            let i = 0;\r\n            while (i < this.itemQuantity.length) {\r\n                subtotal = subtotal + parseInt(this.filterFoods[i].food_price) * this.itemQuantity[i]\r\n                discount = discount + parseInt(this.filterFoods[i].food_discount) * this.itemQuantity[i]\r\n                i = i + 1\r\n            }\r\n            if (!this.filterFoods.length) {\r\n                delivery = 0\r\n            }\r\n            let total = subtotal - discount + delivery;\r\n            return [subtotal, discount, delivery, total];\r\n        },\r\n\r\n        async getAllCartItem() {\r\n            if (this.user) {\r\n                let existItem = await axios.get('/cartItem/' + this.user.user_id);\r\n                existItem.data.forEach(element => {\r\n                    this.cartItem.push(element.food_id);\r\n                    this.itemQuantity.push(element.item_qty);\r\n                });\r\n            }\r\n        },\r\n\r\n        resetCheckErr: function () {\r\n            this.errorObj.phoneErr = [];\r\n            this.errorObj.addressErr = [];\r\n            this.errorObj.payErr = [];\r\n            this.errorObj.numErr = [];\r\n            this.errorObj.nameErr = [];\r\n            this.errorObj.exDateErr = [];\r\n            this.errorObj.cvvErr = [];\r\n        },\r\n\r\n        checkEmptyErr: function () {\r\n            for (var typeErr in this.errorObj) {\r\n                if (this.errorObj[typeErr].length != 0) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n\r\n        inputUpcase: function (e) {\r\n            e.target.value = e.target.value.toUpperCase()\r\n        },\r\n\r\n        checkForm: function () {\r\n            this.resetCheckErr();\r\n\r\n            // Phone validate\r\n            if (!this.checkoutObj.phone) {\r\n                this.errorObj.phoneErr.push('Entering phone number is required');\r\n            }\r\n            else {\r\n                if (!this.checkoutObj.phone.startsWith('84')) {\r\n                    this.errorObj.phoneErr.push('Phone numbers must start with 84');\r\n                }\r\n\r\n                if (this.checkoutObj.phone.length != 11) {\r\n                    this.errorObj.phoneErr.push('Phone numbers must have exactly 11 digits');\r\n                }\r\n\r\n                if (!/[0-9]{11}/.test(this.checkoutObj.phone)) {\r\n                    this.errorObj.phoneErr.push('Phone numbers can only contain numbers');\r\n                }\r\n            }\r\n\r\n            // Address validate\r\n            if (!this.checkoutObj.address) {\r\n                this.errorObj.addressErr.push('Entering address is required');\r\n            }\r\n\r\n            // Card validate\r\n            if (!this.checkoutObj.paymentMethod) {\r\n                this.errorObj.payErr.push('Selecting payment method is required');\r\n            }\r\n            else if (this.checkoutObj.paymentMethod == \"card\") {\r\n                if (!this.cardObj.number) {\r\n                    this.errorObj.numErr.push('Entering card number is required');\r\n                }\r\n                else {\r\n                    if (!this.cardObj.number.startsWith('4')) {\r\n                        this.errorObj.numErr.push('Visa card numbers must start with 4');\r\n                    }\r\n\r\n                    if (this.cardObj.number.length != 16) {\r\n                        this.errorObj.numErr.push('Visa card numbers must have exactly 16 digits');\r\n                    }\r\n\r\n                    if (!/[0-9]{16}/.test(this.cardObj.number)) {\r\n                        this.errorObj.numErr.push('Visa card numbers can only contain numbers');\r\n                    }\r\n                }\r\n\r\n                if (!this.cardObj.name) {\r\n                    this.errorObj.nameErr.push('Entering name is required');\r\n                }\r\n                else {\r\n                    if (!/^[A-Za-z]+$/.test(this.cardObj.name.replace(/\\s/g, \"\"))) {\r\n                        this.errorObj.nameErr.push('A name can only contain letters');\r\n                    }\r\n                }\r\n\r\n                if (!this.cardObj.expiryDate) {\r\n                    this.errorObj.exDateErr.push('Entering expiry date is required');\r\n                }\r\n\r\n\r\n                if (!this.cardObj.cvv) {\r\n                    this.errorObj.cvvErr.push('Entering cvv code is required');\r\n                }\r\n                else {\r\n                    if (this.cardObj.cvv.length != 3) {\r\n                        this.errorObj.cvvErr.push('Cvv code must have exactly 3 digits');\r\n                    }\r\n\r\n                    if (!/[0-9]{3}/.test(this.cardObj.cvv)) {\r\n                        this.errorObj.cvvErr.push('Cvv code can only contain numbers');\r\n                    }\r\n                }\r\n            } else if (this.checkoutObj.paymentMethod == \"cash\") {\r\n                this.cardObj.number = \"\";\r\n                this.cardObj.name = \"\";\r\n                this.cardObj.expiryDate = \"\";\r\n                this.cardObj.cvv = \"\";\r\n\r\n                this.errorObj.numErr = [];\r\n                this.errorObj.nameErr = [];\r\n                this.errorObj.exDateErr = [];\r\n                this.errorObj.cvvErr = [];\r\n            }\r\n        },\r\n\r\n        isPaid: function () {\r\n            if (this.checkoutObj.paymentMethod == \"cash\") {\r\n                return \"false\"\r\n            }\r\n            else if (this.checkoutObj.paymentMethod == \"card\") {\r\n                return \"true\"\r\n            }\r\n        },\r\n\r\n        async sendBillDetails(billId, foodId, qty) {\r\n            let billDetails = {\r\n                bill_id: parseInt(billId),\r\n                food_id: parseInt(foodId),\r\n                item_qty: parseInt(qty)\r\n            }\r\n\r\n            await axios.post(\"/billdetails\", billDetails);\r\n        },\r\n\r\n        async handleSubmit(e) {\r\n            this.checkForm();\r\n\r\n            if (!this.checkEmptyErr()) {\r\n                e.preventDefault();\r\n            } else {\r\n                e.preventDefault();\r\n                let billId = (await axios.get(\"/billstatus/new\")).data;\r\n\r\n                if (billId == \"\") {\r\n                    billId = 1\r\n                } else {\r\n                    billId = parseInt(billId.bill_id) + 1\r\n                }\r\n\r\n                this.cartItem.forEach((foodId, index) => {\r\n                    this.sendBillDetails(billId, foodId, this.itemQuantity[index])\r\n                });\r\n\r\n                var now = new Date();\r\n                var day = (\"0\" + now.getDate()).slice(-2);\r\n                var month = (\"0\" + (now.getMonth() + 1)).slice(-2);\r\n                var hour = (\"0\" + (now.getHours())).slice(-2);\r\n                var min = (\"0\" + (now.getMinutes())).slice(-2);\r\n                var currentTime = now.getFullYear() + \"-\" + month + \"-\" + day + \"T\" + hour + \":\" + min;\r\n\r\n                let billStatus = {\r\n                    bill_id: parseInt(billId),\r\n                    user_id: parseInt(this.user.user_id),\r\n                    bill_phone: this.checkoutObj.phone,\r\n                    bill_address: this.checkoutObj.address,\r\n                    bill_when: currentTime,\r\n                    bill_method: this.checkoutObj.paymentMethod,\r\n                    bill_discount: parseInt(this.calculateSummaryPrice()[1]),\r\n                    bill_delivery: parseInt(this.calculateSummaryPrice()[2]),\r\n                    bill_total: parseInt(this.calculateSummaryPrice()[3]),\r\n                    bill_paid: this.isPaid(),\r\n                    bill_status: 1\r\n                }\r\n\r\n                axios.post(\"/billstatus\", billStatus);\r\n                axios.delete(\"/cartItem/\" + this.user.user_id);\r\n\r\n                this.cartItem = [];\r\n                this.itemQuantity = [];\r\n\r\n                this.$router.push(\"/thank\");\r\n\r\n            }\r\n        }\r\n    }\r\n};\r\n</script>\r\n\r\n<script setup>\r\n// enables v-focus in templates\r\nconst vUpcase = {\r\n    mounted(el) {\r\n        el.style.textTransform = \"uppercase\";\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.checkout-container {\r\n    padding: 2rem 9%;\r\n}\r\n\r\n.checkout-container .checkout-form-container {\r\n    background: #fff;\r\n    height: 90vh;\r\n}\r\n\r\n.checkout-container .checkout-form-container form {\r\n    position: absolute;\r\n    top: 50%;\r\n    left: 50%;\r\n    transform: translate(-50%, -42%);\r\n    max-width: 70rem;\r\n    width: 100%;\r\n    box-shadow: 0 1rem 1rem rgba(0, 0, 0, 0.05);\r\n    border: 0.1rem solid rgba(0, 0, 0, 0.2);\r\n    padding: 2rem;\r\n    border-radius: 0.5rem;\r\n    animation: fadeUp 0.4s linear;\r\n}\r\n\r\n.checkout-container .checkout-form-container form h3 {\r\n    padding-bottom: 1rem;\r\n    font-size: 2rem;\r\n    text-transform: uppercase;\r\n    color: #130f40;\r\n    margin: 0;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .form-control {\r\n    margin: 0.7rem 0;\r\n    border-radius: 0.5rem;\r\n    background: #f7f7f7;\r\n    padding: 2rem 1.2rem;\r\n    font-size: 1.6rem;\r\n    color: #130f40;\r\n    text-transform: none;\r\n    width: 100%;\r\n    border: none;\r\n}\r\n\r\n.checkout-container .checkout-form-container form label {\r\n    font-size: 2rem;\r\n    margin: 0;\r\n    padding: 0;\r\n}\r\n\r\n.checkout-container .checkout-form-container form span {\r\n    font-size: 18px;\r\n    padding-left: 5px;\r\n    padding-right: 40px;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .btn {\r\n    margin: 1rem 0;\r\n    width: 100%;\r\n    text-align: center;\r\n}\r\n\r\n.checkout-container .checkout-form-container form p {\r\n    padding-top: 1rem;\r\n    font-size: 1.5rem;\r\n    color: #666;\r\n    margin: 0;\r\n}\r\n\r\n.checkout-container .checkout-form-container form p a {\r\n    color: #27ae60;\r\n}\r\n\r\n.checkout-container .checkout-form-container form p a:hover {\r\n    color: #130f40;\r\n    text-decoration: underline;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .form-group {\r\n    margin: 0;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .form-group.details-group {\r\n    margin-top: 40px;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .form-group .error-mess {\r\n    font-size: 1.5rem;\r\n    position: relative;\r\n    color: rgb(243, 47, 47);\r\n    margin: 0;\r\n    padding: 0;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .checkout-heading h3 {\r\n    display: flex;\r\n    justify-content: space-between;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .checkout-heading h3 span {\r\n    padding-right: 0px;\r\n    color: #f38609;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .checkout-heading h3:first-of-type span {\r\n    padding-right: 0px;\r\n    color: #130f40;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}