{"ast":null,"code":"import axios from \"axios\";\nimport { mapState } from \"vuex\";\nconst __default__ = {\n  name: \"Checkout\",\n\n  data() {\n    return {\n      checkoutObj: {\n        phone: \"\",\n        address: \"\",\n        paymentMethod: \"\"\n      },\n      cardObj: {\n        number: \"\",\n        name: \"\",\n        expiryDate: \"\",\n        cvv: \"\"\n      },\n      errorObj: {\n        phoneErr: [],\n        addressErr: [],\n        payErr: [],\n        numErr: [],\n        nameErr: [],\n        exDateErr: [],\n        cvvErr: []\n      },\n      cartItem: [],\n      itemQuantity: []\n    };\n  },\n\n  created() {\n    this.getAllCartItem();\n  },\n\n  computed: { ...mapState([\"allFoods\", \"user\"]),\n    filterFoods: function () {\n      return this.allFoods.filter(f => this.matchID(f, this.cartItem));\n    }\n  },\n  methods: {\n    availableTime: function () {\n      var now = new Date();\n      var currentMonth = (\"0\" + (now.getMonth() + 1)).slice(-2);\n      var minRange = now.getFullYear() + \"-\" + currentMonth;\n      var maxRange = now.getFullYear() + 10 + \"-\" + currentMonth;\n      document.getElementById(\"coCardEx\").setAttribute(\"min\", minRange);\n      document.getElementById(\"coCardEx\").setAttribute(\"max\", maxRange);\n    },\n    matchID: function (food, cartArray) {\n      let temp = \"\";\n      cartArray.forEach(element => {\n        if (parseInt(food.food_id) == element) {\n          temp = food;\n        }\n      });\n      return temp;\n    },\n    calculateSummaryPrice: function () {\n      let subtotal = 0;\n      let discount = 0;\n      let delivery = 15;\n      let i = 0;\n\n      while (i < this.itemQuantity.length) {\n        subtotal = subtotal + parseInt(this.filterFoods[i].food_price) * this.itemQuantity[i];\n        discount = discount + parseInt(this.filterFoods[i].food_discount) * this.itemQuantity[i];\n        i = i + 1;\n      }\n\n      if (!this.filterFoods.length) {\n        delivery = 0;\n      }\n\n      let total = subtotal - discount + delivery;\n      return [subtotal, discount, delivery, total];\n    },\n\n    async getAllCartItem() {\n      if (this.user) {\n        let existItem = await axios.get('/cartItem/' + this.user.user_id);\n        existItem.data.forEach(element => {\n          this.cartItem.push(element.food_id);\n          this.itemQuantity.push(element.item_qty);\n        });\n      }\n    },\n\n    resetCheckErr: function () {\n      this.errorObj.phoneErr = [];\n      this.errorObj.addressErr = [];\n      this.errorObj.payErr = [];\n      this.errorObj.numErr = [];\n      this.errorObj.nameErr = [];\n      this.errorObj.exDateErr = [];\n      this.errorObj.cvvErr = [];\n    },\n    checkEmptyErr: function () {\n      for (var typeErr in this.errorObj) {\n        if (this.errorObj[typeErr].length != 0) {\n          return false;\n        }\n      }\n\n      return true;\n    },\n    inputUpcase: function (e) {\n      e.target.value = e.target.value.toUpperCase();\n    },\n    checkForm: function () {\n      this.resetCheckErr(); // Phone validate\n\n      if (!this.checkoutObj.phone) {\n        this.errorObj.phoneErr.push('Entering phone number is required');\n      } else {\n        if (!this.checkoutObj.phone.startsWith('84')) {\n          this.errorObj.phoneErr.push('Phone numbers must start with 84');\n        }\n\n        if (this.checkoutObj.phone.length != 11) {\n          this.errorObj.phoneErr.push('Phone numbers must have exactly 11 digits');\n        }\n\n        if (!/[0-9]{11}/.test(this.checkoutObj.phone)) {\n          this.errorObj.phoneErr.push('Phone numbers can only contain numbers');\n        }\n      } // Address validate\n\n\n      if (!this.checkoutObj.address) {\n        this.errorObj.addressErr.push('Entering address is required');\n      } // Card validate\n\n\n      if (!this.checkoutObj.paymentMethod) {\n        this.errorObj.payErr.push('Selecting payment method is required');\n      } else if (this.checkoutObj.paymentMethod == \"card\") {\n        if (!this.cardObj.number) {\n          this.errorObj.numErr.push('Entering card number is required');\n        } else {\n          if (!this.cardObj.number.startsWith('4')) {\n            this.errorObj.numErr.push('Visa card numbers must start with 4');\n          }\n\n          if (this.cardObj.number.length != 16) {\n            this.errorObj.numErr.push('Visa card numbers must have exactly 16 digits');\n          }\n\n          if (!/[0-9]{16}/.test(this.cardObj.number)) {\n            this.errorObj.numErr.push('Visa card numbers can only contain numbers');\n          }\n        }\n\n        if (!this.cardObj.name) {\n          this.errorObj.nameErr.push('Entering name is required');\n        } else {\n          if (!/^[A-Za-z]+$/.test(this.cardObj.name.replace(/\\s/g, \"\"))) {\n            this.errorObj.nameErr.push('A name can only contain letters');\n          }\n        }\n\n        if (!this.cardObj.expiryDate) {\n          this.errorObj.exDateErr.push('Entering expiry date is required');\n        }\n\n        if (!this.cardObj.cvv) {\n          this.errorObj.cvvErr.push('Entering cvv code is required');\n        } else {\n          if (this.cardObj.cvv.length != 3) {\n            this.errorObj.cvvErr.push('Cvv code must have exactly 3 digits');\n          }\n\n          if (!/[0-9]{3}/.test(this.cardObj.cvv)) {\n            this.errorObj.cvvErr.push('Cvv code can only contain numbers');\n          }\n        }\n      } else if (this.checkoutObj.paymentMethod == \"cash\") {\n        this.cardObj.number = \"\";\n        this.cardObj.name = \"\";\n        this.cardObj.expiryDate = \"\";\n        this.cardObj.cvv = \"\";\n        this.errorObj.numErr = [];\n        this.errorObj.nameErr = [];\n        this.errorObj.exDateErr = [];\n        this.errorObj.cvvErr = [];\n      }\n    },\n    isPaid: function () {\n      if (this.checkoutObj.paymentMethod == \"cash\") {\n        return \"false\";\n      } else if (this.checkoutObj.paymentMethod == \"card\") {\n        return \"true\";\n      }\n    },\n\n    async sendBillDetails(billId, foodId, qty) {\n      let billDetails = {\n        bill_id: parseInt(billId),\n        food_id: parseInt(foodId),\n        item_qty: parseInt(qty)\n      };\n      await axios.post(\"/billdetails\", billDetails);\n    },\n\n    async handleSubmit(e) {\n      this.checkForm();\n\n      if (!this.checkEmptyErr()) {\n        e.preventDefault();\n      } else {\n        e.preventDefault();\n        let billId = (await axios.get(\"/billstatus/new\")).data;\n\n        if (billId == \"\") {\n          billId = 1;\n        } else {\n          billId = parseInt(billId.bill_id) + 1;\n        }\n\n        this.cartItem.forEach((foodId, index) => {\n          this.sendBillDetails(billId, foodId, this.itemQuantity[index]);\n        });\n        var now = new Date();\n        var day = (\"0\" + now.getDate()).slice(-2);\n        var month = (\"0\" + (now.getMonth() + 1)).slice(-2);\n        var hour = (\"0\" + now.getHours()).slice(-2);\n        var min = (\"0\" + now.getMinutes()).slice(-2);\n        var currentTime = now.getFullYear() + \"-\" + month + \"-\" + day + \"T\" + hour + \":\" + min;\n        let billStatus = {\n          bill_id: parseInt(billId),\n          user_id: parseInt(this.user.user_id),\n          bill_phone: this.checkoutObj.phone,\n          bill_address: this.checkoutObj.address,\n          bill_when: currentTime,\n          bill_method: this.checkoutObj.paymentMethod,\n          bill_discount: parseInt(this.calculateSummaryPrice()[1]),\n          bill_delivery: parseInt(this.calculateSummaryPrice()[2]),\n          bill_total: parseInt(this.calculateSummaryPrice()[3]),\n          bill_paid: this.isPaid(),\n          bill_status: 1\n        };\n        axios.post(\"/billstatus\", billStatus);\n        axios.delete(\"/cartItem/\" + this.user.user_id);\n        this.cartItem = [];\n        this.itemQuantity = [];\n        this.$router.push(\"/thank\");\n      }\n    }\n\n  }\n};\nexport default /*#__PURE__*/Object.assign(__default__, {\n  setup(__props, {\n    expose\n  }) {\n    expose(); // enables v-focus in templates\n\n    const vUpcase = {\n      mounted(el) {\n        el.style.textTransform = \"uppercase\";\n      }\n\n    };\n    const __returned__ = {\n      vUpcase,\n      axios,\n      mapState\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n\n});","map":{"version":3,"mappings":"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","names":["axios","mapState","name","data","checkoutObj","phone","address","paymentMethod","cardObj","number","expiryDate","cvv","errorObj","phoneErr","addressErr","payErr","numErr","nameErr","exDateErr","cvvErr","cartItem","itemQuantity","created","getAllCartItem","computed","filterFoods","allFoods","filter","f","matchID","methods","availableTime","now","Date","currentMonth","getMonth","slice","minRange","getFullYear","maxRange","document","getElementById","setAttribute","food","cartArray","temp","forEach","element","parseInt","food_id","calculateSummaryPrice","subtotal","discount","delivery","i","length","food_price","food_discount","total","user","existItem","get","user_id","push","item_qty","resetCheckErr","checkEmptyErr","typeErr","inputUpcase","e","target","value","toUpperCase","checkForm","startsWith","test","replace","isPaid","sendBillDetails","billId","foodId","qty","billDetails","bill_id","post","handleSubmit","preventDefault","index","day","getDate","month","hour","getHours","min","getMinutes","currentTime","billStatus","bill_phone","bill_address","bill_when","bill_method","bill_discount","bill_delivery","bill_total","bill_paid","bill_status","delete","$router","vUpcase","mounted","el","style","textTransform"],"sources":["C:/Users/satwi/Downloads/temp/restaurant-ordering-system/frontend/src/pages/Checkout.vue"],"sourcesContent":["<template>\r\n    <div class=\"checkout-container\">\r\n        <div class=\"checkout-form-container\">\r\n            <form id=\"checkoutForm\" @submit=\"handleSubmit\" novalidate autocomplete=\"off\">\r\n                <div class=\"checkout-heading\">\r\n                    <h3>Few more step to place your order<span>Total</span></h3>\r\n                    <h3 v-if=\"user\">{{ user.user_name }}'s Order<span>${{ calculateSummaryPrice()[3] }}</span></h3>\r\n                </div>\r\n\r\n                <div class=\"form-group details-group\">\r\n                    <h4>Shipping Details</h4>\r\n                    <div class=\"form-group\">\r\n                        <input type=\"text\" name=\"coPhone\" id=\"coPhone\" placeholder=\"Phone number\" class=\"form-control\"\r\n                            v-model=\"checkoutObj.phone\" />\r\n                        <p class=\"error-mess\" v-if=\"errorObj.phoneErr.length > 0\">{{ errorObj.phoneErr[0] }}</p>\r\n                    </div>\r\n\r\n                    <div class=\"form-group\">\r\n                        <input type=\"text\" name=\"coAddress\" id=\"coAddress\" placeholder=\"Address in Hanoi, Vietnam\"\r\n                            class=\"form-control\" v-model=\"checkoutObj.address\" />\r\n                        <p class=\"error-mess\" v-if=\"errorObj.addressErr.length > 0\">{{ errorObj.addressErr[0] }}</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div class=\"form-group details-group\">\r\n                    <h4>Payment Method</h4>\r\n                    <div class=\"form-group\">\r\n                        <div class=\"form-group\">\r\n                            <input type=\"radio\" name=\"payment\" value=\"cash\" id=\"paymentCash\"\r\n                                v-model=\"checkoutObj.paymentMethod\" /><span>Cash</span>\r\n                            <input type=\"radio\" name=\"payment\" value=\"card\" id=\"paymentCard\"\r\n                                v-model=\"checkoutObj.paymentMethod\" /><span>Card (Visa)</span>\r\n                        </div>\r\n                        <p class=\"error-mess\" v-if=\"errorObj.payErr.length > 0\">{{ errorObj.payErr[0] }}</p>\r\n                    </div>\r\n\r\n\r\n                    <div v-if=\"checkoutObj.paymentMethod == 'card'\">\r\n                        <div class=\"form-group\">\r\n                            <input type=\"text\" name=\"coCardNum\" placeholder=\"Enter your card number\" id=\"coCardNum\"\r\n                                class=\"form-control\" v-model=\"cardObj.number\" size=\"16\" maxlength=\"16\" />\r\n                            <p class=\"error-mess\" v-if=\"errorObj.numErr.length > 0\">{{ errorObj.numErr[0] }}</p>\r\n                        </div>\r\n\r\n                        <div class=\"form-group\">\r\n                            <input v-upcase type=\"text\" name=\"coCardName\" placeholder=\"Enter the name in your card \"\r\n                                id=\"coCardName\" class=\"form-control\" v-model=\"cardObj.name\" />\r\n                            <p class=\"error-mess\" v-if=\"errorObj.nameErr.length > 0\">{{ errorObj.nameErr[0] }}</p>\r\n                        </div>\r\n\r\n                        <div class=\"form-group\">\r\n                            <div class=\"form-control\">\r\n                                <span\r\n                                    style=\"font-size: 1.6rem; position: absolute; margin-left: -5px; margin-top: -11px;\">Expiry\r\n                                    Date:\r\n                                </span>\r\n                                <input\r\n                                    style=\"position: absolute; margin-left: 100px; margin-top: -12px; background: inherit;\"\r\n                                    type=\"month\" name=\"coCardEx\" id=\"coCardEx\" v-model=\"cardObj.expiryDate\"\r\n                                    @click=\"availableTime()\" />\r\n                            </div>\r\n                            <p class=\"error-mess\" v-if=\"errorObj.exDateErr.length > 0\">{{ errorObj.exDateErr[0] }}</p>\r\n                        </div>\r\n\r\n                        <div class=\"form-group\">\r\n                            <input type=\"text\" name=\"coCardCvv\" placeholder=\"CVV\" id=\"coCardCvv\" class=\"form-control\"\r\n                                v-model=\"cardObj.cvv\" />\r\n                            <p class=\"error-mess\" v-if=\"errorObj.cvvErr.length > 0\">{{ errorObj.cvvErr[0] }}</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div v-if=\"user\" class=\"form-group\">\r\n                    <input type=\"submit\" value=\"CONFIRM & PAY\" class=\"btn\"\r\n                        :disabled=\"filterFoods.length ? false : true\" />\r\n                </div>\r\n            </form>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\";\r\nimport { mapState } from \"vuex\";\r\nexport default {\r\n    name: \"Checkout\",\r\n\r\n    data() {\r\n        return {\r\n            checkoutObj: { phone: \"\", address: \"\", paymentMethod: \"\" },\r\n            cardObj: { number: \"\", name: \"\", expiryDate: \"\", cvv: \"\" },\r\n            errorObj: { phoneErr: [], addressErr: [], payErr: [], numErr: [], nameErr: [], exDateErr: [], cvvErr: [] },\r\n            cartItem: [],\r\n            itemQuantity: [],\r\n        }\r\n    },\r\n\r\n    created() {\r\n        this.getAllCartItem();\r\n    },\r\n\r\n    computed: {\r\n        ...mapState([\"allFoods\", \"user\"]),\r\n\r\n        filterFoods: function () {\r\n            return this.allFoods.filter(\r\n                (f) => this.matchID(f, this.cartItem)\r\n            );\r\n        },\r\n    },\r\n\r\n    methods: {\r\n        availableTime: function () {\r\n            var now = new Date();\r\n            var currentMonth = (\"0\" + (now.getMonth() + 1)).slice(-2);\r\n\r\n            var minRange = now.getFullYear() + \"-\" + currentMonth;\r\n            var maxRange = (now.getFullYear() + 10) + \"-\" + currentMonth;\r\n\r\n            document.getElementById(\"coCardEx\").setAttribute(\"min\", minRange);\r\n            document.getElementById(\"coCardEx\").setAttribute(\"max\", maxRange);\r\n        },\r\n\r\n        matchID: function (food, cartArray) {\r\n            let temp = \"\";\r\n            cartArray.forEach(element => {\r\n                if (parseInt(food.food_id) == element) {\r\n                    temp = food\r\n                }\r\n            });\r\n            return temp\r\n        },\r\n\r\n        calculateSummaryPrice: function () {\r\n            let subtotal = 0;\r\n            let discount = 0;\r\n            let delivery = 15;\r\n            let i = 0;\r\n            while (i < this.itemQuantity.length) {\r\n                subtotal = subtotal + parseInt(this.filterFoods[i].food_price) * this.itemQuantity[i]\r\n                discount = discount + parseInt(this.filterFoods[i].food_discount) * this.itemQuantity[i]\r\n                i = i + 1\r\n            }\r\n            if (!this.filterFoods.length) {\r\n                delivery = 0\r\n            }\r\n            let total = subtotal - discount + delivery;\r\n            return [subtotal, discount, delivery, total];\r\n        },\r\n\r\n        async getAllCartItem() {\r\n            if (this.user) {\r\n                let existItem = await axios.get('/cartItem/' + this.user.user_id);\r\n                existItem.data.forEach(element => {\r\n                    this.cartItem.push(element.food_id);\r\n                    this.itemQuantity.push(element.item_qty);\r\n                });\r\n            }\r\n        },\r\n\r\n        resetCheckErr: function () {\r\n            this.errorObj.phoneErr = [];\r\n            this.errorObj.addressErr = [];\r\n            this.errorObj.payErr = [];\r\n            this.errorObj.numErr = [];\r\n            this.errorObj.nameErr = [];\r\n            this.errorObj.exDateErr = [];\r\n            this.errorObj.cvvErr = [];\r\n        },\r\n\r\n        checkEmptyErr: function () {\r\n            for (var typeErr in this.errorObj) {\r\n                if (this.errorObj[typeErr].length != 0) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n\r\n        inputUpcase: function (e) {\r\n            e.target.value = e.target.value.toUpperCase()\r\n        },\r\n\r\n        checkForm: function () {\r\n            this.resetCheckErr();\r\n\r\n            // Phone validate\r\n            if (!this.checkoutObj.phone) {\r\n                this.errorObj.phoneErr.push('Entering phone number is required');\r\n            }\r\n            else {\r\n                if (!this.checkoutObj.phone.startsWith('84')) {\r\n                    this.errorObj.phoneErr.push('Phone numbers must start with 84');\r\n                }\r\n\r\n                if (this.checkoutObj.phone.length != 11) {\r\n                    this.errorObj.phoneErr.push('Phone numbers must have exactly 11 digits');\r\n                }\r\n\r\n                if (!/[0-9]{11}/.test(this.checkoutObj.phone)) {\r\n                    this.errorObj.phoneErr.push('Phone numbers can only contain numbers');\r\n                }\r\n            }\r\n\r\n            // Address validate\r\n            if (!this.checkoutObj.address) {\r\n                this.errorObj.addressErr.push('Entering address is required');\r\n            }\r\n\r\n            // Card validate\r\n            if (!this.checkoutObj.paymentMethod) {\r\n                this.errorObj.payErr.push('Selecting payment method is required');\r\n            }\r\n            else if (this.checkoutObj.paymentMethod == \"card\") {\r\n                if (!this.cardObj.number) {\r\n                    this.errorObj.numErr.push('Entering card number is required');\r\n                }\r\n                else {\r\n                    if (!this.cardObj.number.startsWith('4')) {\r\n                        this.errorObj.numErr.push('Visa card numbers must start with 4');\r\n                    }\r\n\r\n                    if (this.cardObj.number.length != 16) {\r\n                        this.errorObj.numErr.push('Visa card numbers must have exactly 16 digits');\r\n                    }\r\n\r\n                    if (!/[0-9]{16}/.test(this.cardObj.number)) {\r\n                        this.errorObj.numErr.push('Visa card numbers can only contain numbers');\r\n                    }\r\n                }\r\n\r\n                if (!this.cardObj.name) {\r\n                    this.errorObj.nameErr.push('Entering name is required');\r\n                }\r\n                else {\r\n                    if (!/^[A-Za-z]+$/.test(this.cardObj.name.replace(/\\s/g, \"\"))) {\r\n                        this.errorObj.nameErr.push('A name can only contain letters');\r\n                    }\r\n                }\r\n\r\n                if (!this.cardObj.expiryDate) {\r\n                    this.errorObj.exDateErr.push('Entering expiry date is required');\r\n                }\r\n\r\n\r\n                if (!this.cardObj.cvv) {\r\n                    this.errorObj.cvvErr.push('Entering cvv code is required');\r\n                }\r\n                else {\r\n                    if (this.cardObj.cvv.length != 3) {\r\n                        this.errorObj.cvvErr.push('Cvv code must have exactly 3 digits');\r\n                    }\r\n\r\n                    if (!/[0-9]{3}/.test(this.cardObj.cvv)) {\r\n                        this.errorObj.cvvErr.push('Cvv code can only contain numbers');\r\n                    }\r\n                }\r\n            } else if (this.checkoutObj.paymentMethod == \"cash\") {\r\n                this.cardObj.number = \"\";\r\n                this.cardObj.name = \"\";\r\n                this.cardObj.expiryDate = \"\";\r\n                this.cardObj.cvv = \"\";\r\n\r\n                this.errorObj.numErr = [];\r\n                this.errorObj.nameErr = [];\r\n                this.errorObj.exDateErr = [];\r\n                this.errorObj.cvvErr = [];\r\n            }\r\n        },\r\n\r\n        isPaid: function () {\r\n            if (this.checkoutObj.paymentMethod == \"cash\") {\r\n                return \"false\"\r\n            }\r\n            else if (this.checkoutObj.paymentMethod == \"card\") {\r\n                return \"true\"\r\n            }\r\n        },\r\n\r\n        async sendBillDetails(billId, foodId, qty) {\r\n            let billDetails = {\r\n                bill_id: parseInt(billId),\r\n                food_id: parseInt(foodId),\r\n                item_qty: parseInt(qty)\r\n            }\r\n\r\n            await axios.post(\"/billdetails\", billDetails);\r\n        },\r\n\r\n        async handleSubmit(e) {\r\n            this.checkForm();\r\n\r\n            if (!this.checkEmptyErr()) {\r\n                e.preventDefault();\r\n            } else {\r\n                e.preventDefault();\r\n                let billId = (await axios.get(\"/billstatus/new\")).data;\r\n\r\n                if (billId == \"\") {\r\n                    billId = 1\r\n                } else {\r\n                    billId = parseInt(billId.bill_id) + 1\r\n                }\r\n\r\n                this.cartItem.forEach((foodId, index) => {\r\n                    this.sendBillDetails(billId, foodId, this.itemQuantity[index])\r\n                });\r\n\r\n                var now = new Date();\r\n                var day = (\"0\" + now.getDate()).slice(-2);\r\n                var month = (\"0\" + (now.getMonth() + 1)).slice(-2);\r\n                var hour = (\"0\" + (now.getHours())).slice(-2);\r\n                var min = (\"0\" + (now.getMinutes())).slice(-2);\r\n                var currentTime = now.getFullYear() + \"-\" + month + \"-\" + day + \"T\" + hour + \":\" + min;\r\n\r\n                let billStatus = {\r\n                    bill_id: parseInt(billId),\r\n                    user_id: parseInt(this.user.user_id),\r\n                    bill_phone: this.checkoutObj.phone,\r\n                    bill_address: this.checkoutObj.address,\r\n                    bill_when: currentTime,\r\n                    bill_method: this.checkoutObj.paymentMethod,\r\n                    bill_discount: parseInt(this.calculateSummaryPrice()[1]),\r\n                    bill_delivery: parseInt(this.calculateSummaryPrice()[2]),\r\n                    bill_total: parseInt(this.calculateSummaryPrice()[3]),\r\n                    bill_paid: this.isPaid(),\r\n                    bill_status: 1\r\n                }\r\n\r\n                axios.post(\"/billstatus\", billStatus);\r\n                axios.delete(\"/cartItem/\" + this.user.user_id);\r\n\r\n                this.cartItem = [];\r\n                this.itemQuantity = [];\r\n\r\n                this.$router.push(\"/thank\");\r\n\r\n            }\r\n        }\r\n    }\r\n};\r\n</script>\r\n\r\n<script setup>\r\n// enables v-focus in templates\r\nconst vUpcase = {\r\n    mounted(el) {\r\n        el.style.textTransform = \"uppercase\";\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.checkout-container {\r\n    padding: 2rem 9%;\r\n}\r\n\r\n.checkout-container .checkout-form-container {\r\n    background: #fff;\r\n    height: 90vh;\r\n}\r\n\r\n.checkout-container .checkout-form-container form {\r\n    position: absolute;\r\n    top: 50%;\r\n    left: 50%;\r\n    transform: translate(-50%, -42%);\r\n    max-width: 70rem;\r\n    width: 100%;\r\n    box-shadow: 0 1rem 1rem rgba(0, 0, 0, 0.05);\r\n    border: 0.1rem solid rgba(0, 0, 0, 0.2);\r\n    padding: 2rem;\r\n    border-radius: 0.5rem;\r\n    animation: fadeUp 0.4s linear;\r\n}\r\n\r\n.checkout-container .checkout-form-container form h3 {\r\n    padding-bottom: 1rem;\r\n    font-size: 2rem;\r\n    text-transform: uppercase;\r\n    color: #130f40;\r\n    margin: 0;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .form-control {\r\n    margin: 0.7rem 0;\r\n    border-radius: 0.5rem;\r\n    background: #f7f7f7;\r\n    padding: 2rem 1.2rem;\r\n    font-size: 1.6rem;\r\n    color: #130f40;\r\n    text-transform: none;\r\n    width: 100%;\r\n    border: none;\r\n}\r\n\r\n.checkout-container .checkout-form-container form label {\r\n    font-size: 2rem;\r\n    margin: 0;\r\n    padding: 0;\r\n}\r\n\r\n.checkout-container .checkout-form-container form span {\r\n    font-size: 18px;\r\n    padding-left: 5px;\r\n    padding-right: 40px;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .btn {\r\n    margin: 1rem 0;\r\n    width: 100%;\r\n    text-align: center;\r\n}\r\n\r\n.checkout-container .checkout-form-container form p {\r\n    padding-top: 1rem;\r\n    font-size: 1.5rem;\r\n    color: #666;\r\n    margin: 0;\r\n}\r\n\r\n.checkout-container .checkout-form-container form p a {\r\n    color: #27ae60;\r\n}\r\n\r\n.checkout-container .checkout-form-container form p a:hover {\r\n    color: #130f40;\r\n    text-decoration: underline;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .form-group {\r\n    margin: 0;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .form-group.details-group {\r\n    margin-top: 40px;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .form-group .error-mess {\r\n    font-size: 1.5rem;\r\n    position: relative;\r\n    color: rgb(243, 47, 47);\r\n    margin: 0;\r\n    padding: 0;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .checkout-heading h3 {\r\n    display: flex;\r\n    justify-content: space-between;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .checkout-heading h3 span {\r\n    padding-right: 0px;\r\n    color: #f38609;\r\n}\r\n\r\n.checkout-container .checkout-form-container form .checkout-heading h3:first-of-type span {\r\n    padding-right: 0px;\r\n    color: #130f40;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}